<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Immobili - Dashboard</title>
	
	<!-- Manifest e tema -->
	<link rel="manifest" href="manifest.json">
	<meta name="theme-color" content="#2196f3">
	<link rel="icon" href="icon-192.png" type="image/png">

	<link rel="stylesheet" href="css/common.css">
	<link rel="stylesheet" href="css/tema_immobili.css">

	<!-- Registrazione service worker -->
	<script>
	  if ('serviceWorker' in navigator) {
		navigator.serviceWorker.register('service-worker.js')
		  .then(() => console.log("Service Worker registrato"))
		  .catch(err => console.error("Errore SW:", err));
	  }
	</script>
	
	<body data-json="data/immobili.json">
    	
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script src="js/dashboard.js"></script>
	<script>
		async function caricaDati() {
			const file = document.body.dataset.json;
			const response = await fetch(file);
			dati = await response.json();
			inizializzaApp();
		}
		document.addEventListener('DOMContentLoaded', caricaDati);
	</script>
</head>
<body>
	
	<header class="header-bar">
		<div class="header-left">
			<h1>ğŸ  Immobili</h1>
			<p class="subtitle">Dashboard spese condominiali e utenze</p>
		</div>

		<div class="header-right">
			<button id="btn-export" class="header-btn" onclick="esportaPDF({
				  titolo: 'Dashboard Immobili',
				  nomeFile: 'immobili_riepilogo.pdf',
				  sottotitolo: 'Riepilogo spese e saldi'
				})">ğŸ“„ Esporta PDF</button>
			<button id="btn-back" class="header-btn" onclick="location.href='index.html'">Indietro</button>
		</div>
	</header>
    
    <div class="section">
       <div class="section-header">
			<h2>ğŸ’° Riepilogo per Erede</h2>
			<p class="section-subtitle">Riepilogo tra dovuto e pagato, per singolo erede.</p>
		</div>      
        <div class="summary-grid" id="riepilogoEredi"></div>
    </div>
    
    <div class="section">
        <div class="section-header">
			<h2>ğŸ¯ Situazione saldi</h2>
			<p class="section-subtitle">Saldo finale tra gli eredi, calcolato come differenza tra quanto dovuto e quanto pagato.</p>
		</div>
        <div id="chiDeveAChi"></div>
    </div>
    
    <div class="section">
        <div class="section-header">
			<h2>ğŸ“Š Spese</h2>
			<p class="section-subtitle">Elenco spese in dettaglio</p>
		</div> 
        <div class="filters">
            <select id="filtroCategoria">
                <option value="">Tutte le categorie</option>
            </select>
            <input type="text" id="filtroRicerca" placeholder="Cerca descrizione...">
			<label style="display:flex;align-items:center;gap:5px;">
				<input type="checkbox" id="filtroDaPagare">
				<span>Da pagare</span>
			</label>
        </div>
        <table id="tabellaSpese">
            <thead>
                <tr>
                    <th class="sortable" data-column="data" data-type="string">Data</th>
                    <th class="sortable" data-column="categoria" data-type="string">Categoria</th>
                    <th class="sortable" data-column="creditore" data-type="string">Creditore</th>
                    <th class="sortable" data-column="descrizione" data-type="string">Descrizione</th>
                    <th class="sortable" data-column="importo" data-type="number">Importo</th>
                    <th>Pagato da</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    
    <div class="section">
        <div class="section-header">
			<h2>ğŸ’¸ Trasferimenti</h2>
			<p class="section-subtitle">Elenco dei trasferimenti di denaro tra eredi</p>
		</div> 
        <table id="tabellaTrasferimenti">
            <thead>
                <tr>
                    <th class="sortable" data-column="data" data-type="string">Data</th>
                    <th class="sortable" data-column="da" data-type="string">Da</th>
                    <th class="sortable" data-column="a" data-type="string">A</th>
                    <th class="sortable" data-column="importo" data-type="number">Importo</th>
                    <th>Note</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- Libreria jsPDF per export PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    
</body>
</html>